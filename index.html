<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PC Dual Color • v17 • Seeded Left/Right Color Cycling</title>
<style>
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:#000;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif}
  #left,#right{position:fixed;top:0;bottom:0;width:50%;transition:background-color .8s linear}
  #left{left:0} #right{right:0}
  #divider{position:fixed;top:0;bottom:0;left:50%;width:1px;background:rgba(255,255,255,.14);pointer-events:none}
  #seedCanvas{position:fixed;inset:0;z-index:10;cursor:crosshair;touch-action:none}
  #hud{position:fixed;left:12px;bottom:12px;color:#bfffe5;background:rgba(0,0,0,.45);padding:8px 10px;border-radius:8px;font:12px/1.4 ui-monospace,Consolas,monospace;z-index:20}
  #menuToggle{position:fixed;left:-9999px}
  #hamburger{position:fixed;left:12px;top:12px;z-index:30;width:36px;height:36px;border-radius:9px;border:1px solid rgba(255,255,255,.25);
    background:rgba(0,0,0,.55);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}
  #menuToggle:not(:checked)~#controls{opacity:0;transform:translateY(-8px);pointer-events:none}
  #controls{
    position:fixed;right:14px;top:14px;z-index:40;background:rgba(0,0,0,.9);color:#fff;width:420px;border-radius:14px;padding:12px;
    border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(6px);transition:.18s;max-height:86vh;overflow:auto
  }
  #controls h3{margin:0 0 8px;text-align:center;color:#93f2b0;font-size:15px}
  .row{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px;margin:6px 0}
  .row>label{font-size:12px;white-space:nowrap}
  .val{font:12px/1 ui-monospace,Consolas,monospace;color:#c0ffd1;min-width:56px;text-align:right}
  .rowBtns{display:grid;grid-template-columns:auto auto auto auto;gap:8px;margin:6px 0}
  button{appearance:none;border:0;border-radius:10px;padding:8px 12px;cursor:pointer;color:#fff;background:#2a9d8f}
  .stop{background:#c62828}.ghost{background:rgba(255,255,255,.18)}
</style>
</head>
<body>
  <div id="left"></div><div id="right"></div><div id="divider"></div>
  <canvas id="seedCanvas"></canvas>
  <input type="checkbox" id="menuToggle" checked>
  <label id="hamburger" for="menuToggle" title="컨트롤 패널 토글(F1/H)">☰</label>

  <div id="controls">
    <h3>좌/우 색상 전환 (팔레트: 7점 Seed)</h3>
    <div class="rowBtns">
      <button id="startBtn">시작</button>
      <button id="stopBtn" class="stop">중지</button>
      <button id="nextBtn" class="ghost">다음 색</button>
      <button id="resetBtn" class="ghost">리셋(점 다시)</button>
    </div>
    <hr>
    <div class="row"><label>유지 시간</label><input id="holdSec" type="range" min="3" max="20" step="1" value="8"><span id="holdSecVal" class="val">8s</span></div>
    <h3>좌/우 명도 · 채도</h3>
    <div class="row"><label>좌 명도</label><input id="gainL" type="range" min="50" max="240" step="1" value="150"><span id="gainLVal" class="val">150%</span></div>
    <div class="row"><label>좌 채도</label><input id="satL"  type="range" min="0"   max="300" step="1" value="160"><span id="satLVal" class="val">1.60×</span></div>
    <div class="row"><label>우 명도</label><input id="gainR" type="range" min="50" max="240" step="1" value="100"><span id="gainRVal" class="val">100%</span></div>
    <div class="row"><label>우 채도</label><input id="satR"  type="range" min="0"   max="300" step="1" value="100"><span id="satRVal" class="val">1.00×</span></div>
  </div>

  <div id="hud">seed: — | running:false</div>

<script>
const $=id=>document.getElementById(id);
const left=$('left'), right=$('right'), hud=$('hud');

/* 숫자 라벨 표시 */
const fmt={pct:v=>`${v}%`, times:v=>`${(v/100).toFixed(2)}×`, secs:v=>`${v|0}s`};
const bindVal=(id,fmtf)=>{ const r=$(id), out=$(id+'Val'); const apply=()=>out.textContent=fmtf(Number(r.value)); r.addEventListener('input',apply); apply(); };
bindVal('gainL',fmt.pct); bindVal('satL',fmt.times); bindVal('gainR',fmt.pct); bindVal('satR',fmt.times); bindVal('holdSec',fmt.secs);

/* 7점 Seed 캔버스 */
const can=$('seedCanvas'), ctx=can.getContext('2d');
const state={points:[], seed:0, palette:[], running:false, timer:null, idx:0};
function fit(){ can.width=innerWidth; can.height=innerHeight; drawPts(); }
function drawPts(){
  ctx.clearRect(0,0,can.width,can.height);
  ctx.fillStyle='#ffee66';
  for(const p of state.points){ctx.beginPath();ctx.arc(p.x,p.y,6,0,Math.PI*2);ctx.fill();}
  if(state.points.length===7){ctx.strokeStyle='#ffeb3b';ctx.lineWidth=2;let i=0;ctx.beginPath();ctx.moveTo(state.points[i].x,state.points[i].y);
    for(let k=0;k<7;k++){i=(i+2)%7;ctx.lineTo(state.points[i].x,state.points[i].y);}ctx.closePath();ctx.stroke();}
}
function rel(e){const r=can.getBoundingClientRect();const p=(e.touches?e.touches[0]:e);return {x:p.clientX-r.left,y:p.clientY-r.top};}
let lock=0,last={x:-1e9,y:-1e9};
function addPt(p){const dx=p.x-last.x,dy=p.y-last.y;if(dx*dx+dy*dy<25)return;if(state.points.length>=7)return;state.points.push(p);last=p;drawPts(); if(state.points.length===7) buildPalette(false);}
function onDown(e){ if(e.target.closest && e.target.closest('#controls')) return; if(can.style.display==='none') return;
  const now=performance.now(); if(now<lock) return; lock=now+80; addPt(rel(e)); e.preventDefault?.(); }
['pointerdown','mousedown','click','touchstart'].forEach(ev=>can.addEventListener(ev,onDown,{passive:false}));
window.addEventListener('resize', fit, {passive:true}); fit();

/* 팔레트 생성(밝고 선명한 계열) */
function hslToCss(h,s,l){ return `hsl(${(h%360+360)%360}deg, ${Math.round(s*100)}%, ${Math.round(l*100)}%)`; }
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return ((t^(t>>>14))>>>0)/4294967296;};}
function computeSeed(){let s=0;for(let i=0;i<state.points.length;i++){const p=state.points[i];s^=(((p.x|0)+(p.y|0))<<(i%24));}return (s>>>0)||0xA5A5A5A5;}
function buildPalette(forceRandom){
  state.seed=(forceRandom||state.points.length<7)?((Math.random()*0xffffffff)>>>0):computeSeed();
  const rng=mulberry32(state.seed), base=Math.floor(rng()*360), N=240, arr=[];
  for(let i=0;i<N;i++){
    const h=(base+i*(360/N)+(rng()*2-1)*12+360)%360;
    const s=0.75+rng()*0.20; // 0.75~0.95 (채도 높은 팔레트)
    const l=0.58+rng()*0.18; // 0.58~0.76 (밝은 팔레트)
    arr.push({h,s,l});
  }
  state.palette=arr; state.idx=0;
  hud.textContent=`seed: 0x${state.seed.toString(16)} | running:${state.running}`;
}

/* 변환(명도=Lightness x gain, 채도=S x sat) */
function transformHSL(hsl, gainPct, satPct){
  const s = Math.max(0, Math.min(1, hsl.s * (satPct/100)));
  let   l = hsl.l * (gainPct/100);
  l = Math.max(0, Math.min(1, l));
  return {h:hsl.h, s, l};
}
function currentColors(){
  if(!state.palette.length) buildPalette(true);
  const base = state.palette[state.idx % state.palette.length];
  const leftHSL  = transformHSL(base, Number($('gainL').value), Number($('satL').value));
  const rightHSL = transformHSL(base, Number($('gainR').value), Number($('satR').value));
  return { leftCss: hslToCss(leftHSL.h,leftHSL.s,leftHSL.l),
           rightCss: hslToCss(rightHSL.h,rightHSL.s,rightHSL.l) };
}
function applyColors(){
  const {leftCss,rightCss}=currentColors();
  left.style.backgroundColor = leftCss;
  right.style.backgroundColor = rightCss;
}

/* 루프(주기적 색 전환) */
function tickOnce(){
  applyColors();
  state.idx = (state.idx + 1) % state.palette.length;
}
function startCycle(){
  if(!state.palette.length) buildPalette(state.points.length<7);
  if(state.timer) clearInterval(state.timer);
  tickOnce(); // 즉시 1회
  const ms = Math.max(3, Math.min(20, Number($('holdSec').value))) * 1000;
  state.timer = setInterval(tickOnce, ms);
  state.running=true; can.style.display='none';
  hud.textContent=`seed: 0x${state.seed.toString(16)} | running:true`;
}
function stopCycle(){
  if(state.timer) clearInterval(state.timer);
  state.timer=null; state.running=false;
  hud.textContent=`seed: 0x${state.seed.toString(16)} | running:false`;
}

/* 버튼 */
$('startBtn').onclick = startCycle;
$('stopBtn').onclick  = stopCycle;
$('nextBtn').onclick  = () => { if(!state.running) applyColors(); else tickOnce(); };
$('resetBtn').onclick = () => { stopCycle(); state.points=[]; state.palette=[]; state.idx=0; can.style.display='block'; drawPts(); };

$('holdSec').addEventListener('input', ()=>{ if(state.running) startCycle(); });

/* 패널 토글 */
function togglePanel(){ $('menuToggle').checked=!$('menuToggle').checked; }
document.addEventListener('keydown', e=>{
  if(/INPUT|TEXTAREA/.test(e.target.tagName)) return;
  if(e.key==='F1' || e.key==='h' || e.key==='H'){ e.preventDefault(); togglePanel(); }
});
</script>
</body>
</html>
